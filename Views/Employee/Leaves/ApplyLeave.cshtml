@model EmployeePortal.ViewModels.EmployeeViewModels.ApplyLeaveModel
@using EmployeePortal.Models

@{
    ViewData["Title"] = "Apply Leave";
}
<style>
    .page-heading {
        color: #005B99; /* Primary Theme Color */
        font-weight: 700;
        letter-spacing: -0.5px;
        font-size: 1.35rem;
    }
</style>
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">

        <div class="card shadow-sm border mb-4">
            <div class="card-body p-4 p-md-5">

                <div class="text-center mb-4">
                    <div class="d-inline-flex align-items-center justify-content-center mb-3"
                         style="width: 50px; height: 50px; background-color: #E6F2FA; color: #005B99; border-radius: 50%;">
                        <i class="bi bi-calendar-plus fs-4"></i>
                    </div>
                    <h3 class="fw-bold page-heading">Apply for Leave</h3>
                    <p class="text-muted small">Fill in the details below to submit your request.</p>
                </div>

                <form asp-action="ApplyLeave" method="post" id="applyLeaveForm" novalidate>
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger py-2 small mb-4" role="alert"></div>

                    <div class="mb-3">
                        <label asp-for="LeaveType" class="form-label fw-semibold text-secondary small text-uppercase">Leave Type</label>
                        <select asp-for="LeaveType"
                                class="form-select"
                                asp-items="Html.GetEnumSelectList<LeaveType>()">
                            <option value="" disabled selected>Select type...</option>
                        </select>
                        <span asp-validation-for="LeaveType" class="text-danger small mt-1 d-block"></span>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label asp-for="FromDate" class="form-label fw-semibold text-secondary small text-uppercase">From Date</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-calendar-event"></i></span>
                                <input asp-for="FromDate"
                                       type="date"
                                       class="form-control border-start-0 ps-0"
                                       id="FromDate"
                                       min="@DateTime.Today.ToString("yyyy-MM-dd")" />
                            </div>
                            <span asp-validation-for="FromDate" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="col-md-6">
                            <label asp-for="ToDate" class="form-label fw-semibold text-secondary small text-uppercase">To Date</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-calendar-event-fill"></i></span>
                                <input asp-for="ToDate"
                                       type="date"
                                       class="form-control border-start-0 ps-0"
                                       id="ToDate"
                                       min="@DateTime.Today.ToString("yyyy-MM-dd")" />
                            </div>
                            <span asp-validation-for="ToDate" class="text-danger small mt-1 d-block"></span>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label asp-for="Reason" class="form-label fw-semibold text-secondary small text-uppercase">Reason</label>
                        <textarea asp-for="Reason"
                                  class="form-control"
                                  rows="4"
                                  style="resize: none;"
                                  placeholder="Briefly describe the reason..."></textarea>
                        <span asp-validation-for="Reason" class="text-danger small mt-1 d-block"></span>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary fw-semibold py-2">
                            Submit Request
                        </button>
                        <a asp-action="LeaveHistory" class="btn btn-light border text-muted">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <div class="text-center mt-3">
            <p class="small text-muted">
                <i class="bi bi-info-circle me-1"></i>
                Check your balance: <a asp-action="LeaveHistory" class="fw-bold text-primary text-decoration-none">View History</a>
            </p>
        </div>

    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const fromDate = document.getElementById("FromDate");
            const toDate = document.getElementById("ToDate");
            const today = new Date().toISOString().split("T")[0];

            if (fromDate && toDate) {
                // Initialize min dates
                if(!fromDate.value) fromDate.min = today;
                if(!toDate.value) toDate.min = today;

                fromDate.addEventListener("change", function () {
                    // Prevent selecting a To Date earlier than From Date
                    toDate.min = fromDate.value;

                    // Auto-correct logic
                    if (toDate.value === "") {
                        toDate.value = fromDate.value;
                    }
                    else if (toDate.value < fromDate.value) {
                        toDate.value = fromDate.value;
                    }
                });

                toDate.addEventListener("change", function () {
                    // If user manually picks an invalid date range
                    if (toDate.value < fromDate.value && fromDate.value !== "") {
                        toDate.value = fromDate.value;
                    }
                });
            }
        });
    </script>
}